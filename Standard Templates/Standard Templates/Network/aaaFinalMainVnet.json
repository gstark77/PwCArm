{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {

    "arrEnvironment": {
      "type": "array",
      "defaultValue": [
        "dev",
        "prd"
      ]
    },

    "arrSnetName": {
      "type": "array",
      "defaultValue": [
        "web",
        "app",
        "dba"
      ]
    },

    "arrSnetPrefix": {
        "type": "array",
        "defaulValue": [
          "10.60.0.0",
          "10.60.1.0",
          "10.60.2.0"
        ]
    },

    "arrApplication": {
      "type": "array",
      "defaultValue": [
        "edw"
      ]

    }
  },

    "variables": {
      "templateBaseUrl": "https://raw.githubusercontent.com/gstark77/PwCArm/master/Standard%20Templates/Standard%20Templates/",
      "vnetTemplateFolderPath": "Network/",
      "vnetTemplateFileName": "aaaFinalVnetLinked.json",
      /*"snetTemplateFileName": "aaaFinalSnetLinked.json",*/ /**/

      "strVnetPrefix": "10.60.0.0",
      "strDnsServer": "192.168.0.1"

    },
    "resources": [
      {
        "name": "[concat('from_main__',copyIndex())]",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2016-09-01",

        "copy": {
          "name": "vnetLoop",
          "count": "[length(parameters('arrEnvironment'))]"
        },

        "properties": {
          "mode": "Incremental",
          "templateLink": {
            "uri": "[concat(variables('templateBaseUrl'),variables('vnetTemplateFolderPath'), variables('vnetTemplateFileName'))]",
            "contentVersion": "1.0.0.0"
          },
          "parameters": {
            "strEnvironment": { "value": "[parameters('arrEnvironment')[copyIndex()]]" },
            "strApplication": { "value": "[parameters('arrApplication')[0]]" }, 
            "strVnetPrefix": { "value": "10.60.0.0" },
            "arrSnetName": { "value": "[parameters('arrSnetName')]" },
            "arrSnetPrefix": { "value": "[parameters('arrSnetPrefix')]" },
            "strDnsServer": { "value": "192.168.0.1" }
          }
        }
      } 
    ],
    "outputs": {
    }
  }
